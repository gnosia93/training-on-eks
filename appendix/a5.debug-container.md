## al2023-debug ##
```
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: al2023-debug
spec:
  containers:
  - name: debug-container
    image: amazonlinux:2023
    command: ["/bin/sh", "-c"]
    args:
      - |
        echo "--- Package Update & Install ---"
        dnf update -y
        dnf install -y bind-utils iputils  # nslookup 및 ping 설치
        
        echo "--- Network Check ---"
        # 1. DNS 확인 (nslookup)
        nslookup google.com
        
        # 2. 로드밸런서 주소 확인 (사용자의 ELB 주소로 변경 가능)
        # nslookup <여기에_ELB_주소를_넣으세요>
        
        echo "--- Keeping Pod Alive ---"
        sleep infinity  # 수동 분석을 위해 파드 유지
    resources:
      limits:
        cpu: "1000m"
        memory: "1Gi"  
EOF
```

## loki-gateway 들여다 보기 ##
nslookup 을 설치한다.
```
kubectl exec -it al2023-debug -- /bin/bash
dnf install -y bind-utils
```
#### loki 게이트웨어 주소 조회 ####
```
nslookup loki-gateway.loki.svc.cluster.local
```
[결과]
```
 nslookup loki-gateway.loki.svc.cluster.local
;; Got recursion not available from 172.20.0.10
;; Got recursion not available from 172.20.0.10
;; Got recursion not available from 172.20.0.10
;; Got recursion not available from 172.20.0.10
Server:         172.20.0.10
Address:        172.20.0.10#53

Name:   loki-gateway.loki.svc.cluster.local
Address: 172.20.143.39
;; Got recursion not available from 172.20.0.10
```

#### 80 포트가 살아있는 확인 ####
```
curl -I http://loki-gateway.loki.svc.cluster.local:80
```
[결과]
```
HTTP/1.1 200 OK
Server: nginx/1.29.3
Date: Wed, 07 Jan 2026 05:34:03 GMT
Content-Type: application/octet-stream
Content-Length: 2
Connection: keep-alive
```

#### 로그 보내기 ####
```
curl -u "loki:loki" -H "Content-Type: application/json" -XPOST -s "http://loki-gateway.loki.svc.cluster.local/loki/api/v1/push" \
--data-raw "{\"streams\": [{\"stream\": {\"job\": \"test\"}, \"values\": [[\"$(date +%s)000000000\", \"fizzbuzz\"]]}]}" \
-H "X-Scope-OrgId: foo"
```
#### 로그 확인하기 ####
```
curl -u "loki:loki" "http://loki-gateway.loki.svc.cluster.local/loki/api/v1/query_range" --data-urlencode 'query={job="test"}' -H X-Scope-OrgId:foo 
```
[결과]
```
{"status":"success","data":{"resultType":"streams","result":[{"stream":{"detected_level":"unknown","job":"test","service_name":"test"},"values":[["1767764442000000000","fizzbuzz"]]}],"stats":{"summary":{"bytesProcessedPerSecond":1562,"linesProcessedPerSecond":97,"totalBytesProcessed":32,"totalLinesProcessed":2,"execTime":0.020485,"queueTime":0.000814,"subqueries":0,"totalEntriesReturned":1,"splits":5,"shards":5,"totalPostFilterLines":2,"totalStructuredMetadataBytesProcessed":16},"querier":{"store":{"totalChunksRef":0,"totalChunksDownloaded":0,"chunksDownloadTime":0,"queryReferencedStructuredMetadata":false,"queryUsedV2Engine":false,"chunk":{"headChunkBytes":0,"headChunkLines":0,"decompressedBytes":0,"decompressedLines":0,"compressedBytes":0,"totalDuplicates":1,"postFilterLines":0,"headChunkStructuredMetadataBytes":0,"decompressedStructuredMetadataBytes":0},"chunkRefsFetchTime":4300665,"congestionControlLatency":0,"pipelineWrapperFilteredLines":0,"dataobj":{"prePredicateDecompressedRows":0,"prePredicateDecompressedBytes":0,"prePredicateDecompressedStructuredMetadataBytes":0,"postPredicateRows":0,"postPredicateDecompressedBytes":0,"postPredicateStructuredMetadataBytes":0,"postFilterRows":0,"pagesScanned":0,"pagesDownloaded":0,"pagesDownloadedBytes":0,"pageBatches":0,"totalRowsAvailable":0,"totalPageDownloadTime":0}}},"ingester":{"totalReached":15,"totalChunksMatched":2,"totalBatches":12,"totalLinesSent":2,"store":{"totalChunksRef":0,"totalChunksDownloaded":0,"chunksDownloadTime":0,"queryReferencedStructuredMetadata":false,"queryUsedV2Engine":false,"chunk":{"headChunkBytes":32,"headChunkLines":2,"decompressedBytes":0,"decompressedLines":0,"compressedBytes":0,"totalDuplicates":0,"postFilterLines":2,"headChunkStructuredMetadataBytes":16,"decompressedStructuredMetadataBytes":0},"chunkRefsFetchTime":0,"congestionControlLatency":0,"pipelineWrapperFilteredLines":0,"dataobj":{"prePredicateDecompressedRows":0,"prePredicateDecompressedBytes":0,"prePredicateDecompressedStructuredMetadataBytes":0,"postPredicateRows":0,"postPredicateDecompressedBytes":0,"postPredicateStructuredMetadataBytes":0,"postFilterRows":0,"pagesScanned":0,"pagesDownloaded":0,"pagesDownloadedBytes":0,"pageBatches":0,"totalRowsAvailable":0,"totalPageDownloadTime":0}}},"cache":{"chunk":{"entriesFound":0,"entriesRequested":0,"entriesStored":0,"bytesReceived":0,"bytesSent":0,"requests":0,"downloadTime":0,"queryLengthServed":0},"index":{"entriesFound":0,"entriesRequested":0,"entriesStored":0,"bytesReceived":0,"bytesSent":0,"requests":0,"downloadTime":0,"queryLengthServed":0},"result":{"entriesFound":0,"entriesRequested":0,"entriesStored":0,"bytesReceived":0,"bytesSent":0,"requests":0,"downloadTime":0,"queryLengthServed":0},"statsResult":{"entriesFound":4,"entriesRequested":4,"entriesStored":0,"bytesReceived":824,"bytesSent":0,"requests":4,"downloadTime":867307,"queryLengthServed":2982000000000},"volumeResult":{"entriesFound":0,"entriesRequested":0,"entriesStored":0,"bytesReceived":0,"bytesSent":0,"requests":0,"downloadTime":0,"queryLengthServed":0},"seriesResult":{"entriesFound":0,"entriesRequested":0,"entriesStored":0,"bytesReceived":0,"bytesSent":0,"requests":0,"downloadTime":0,"queryLengthServed":0},"labelResult":{"entriesFound":0,"entriesRequested":0,"entriesStored":0,"bytesReceived":0,"bytesSent":0,"requests":0,"downloadTime":0,"queryLengthServed":0},"instantMetricResult":{"entriesFound":0,"entriesRequested":0,"entriesStored":0,"bytesReceived":0,"bytesSent":0,"requests":0,"downloadTime":0,"queryLengthServed":0}},"index":{"totalChunks":0,"postFilterChunks":0,"shardsDuration":0,"usedBloomFilters":false}}}}
```

## alloy 들여다 보기 ##
```
kubectl get pods -n alloy
```
[결과]
```
NAME          READY   STATUS    RESTARTS   AGE
alloy-cxlt9   2/2     Running   0          2m32s
alloy-qmqdj   2/2     Running   0          2m32s
alloy-rkd9b   2/2     Running   0          2m33s
alloy-zdkwl   2/2     Running   0          2m32s
```

```
kubectl exec -it alloy-cxlt9 -n alloy -- ls -R /var/log/pods

```


